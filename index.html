<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì´ˆë“± ìŠ¤ë§ˆíŠ¸ ë¬¸ì œì€í–‰ (í™ˆ ë²„íŠ¼ & ë¶€ë¶„ ì‚­ì œ)</title>
    <style>
        :root { --primary: #27ae60; --secondary: #f39c12; --bg: #f4f7f6; --wrong: #e74c3c; --correct: #3498db; --selected: #8e44ad; }
        body { font-family: 'Nanum Gothic', sans-serif; background-color: var(--bg); margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { background: white; width: 100%; max-width: 800px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); overflow: hidden; min-height: 600px; display: flex; flex-direction: column; }
        
        /* íƒ­ ìŠ¤íƒ€ì¼ */
        .tabs { display: flex; background: #eee; }
        .tab-btn { flex: 1; padding: 15px; border: none; background: #eee; font-size: 16px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .tab-btn.active { background: white; color: var(--primary); border-top: 4px solid var(--primary); }
        .tab-content { display: none; padding: 30px; flex: 1; }
        .tab-content.active { display: block; }

        h2 { margin-top: 0; color: #333; }
        h3 { margin-top: 25px; margin-bottom: 10px; border-left: 5px solid var(--primary); padding-left: 10px; }
        select, input { padding: 10px; border: 1px solid #ddd; border-radius: 5px; margin-right: 5px; margin-bottom: 10px; width: 100%; box-sizing: border-box; }
        .row { display: flex; gap: 10px; margin-bottom: 15px; }
        .btn { padding: 12px 20px; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; font-weight: bold; color: white; width: 100%; transition: 0.2s; }
        .btn:hover { opacity: 0.9; }
        .btn-primary { background-color: var(--primary); }
        .btn-danger { background-color: var(--wrong); width: auto; padding: 5px 10px; font-size: 14px; }
        .btn-delete-section { background-color: var(--wrong); color: white; width: 100%; font-weight: bold; }
        .btn-edit { background-color: var(--secondary); width: auto; padding: 5px 10px; font-size: 14px; margin-right: 5px; }
        .btn-success { background-color: #2980b9; }
        .btn-nav { background-color: #7f8c8d; width: 48%; }
        .btn-nav.active { background-color: var(--primary); }
        
        /* í™ˆ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn-home { background-color: #95a5a6; color: white; padding: 8px 15px; border: none; border-radius: 20px; font-size: 14px; cursor: pointer; display: flex; align-items: center; gap: 5px; }
        .btn-home:hover { background-color: #7f8c8d; }

        .file-manager { background: #e8f5e9; padding: 15px; border-radius: 10px; border: 1px solid #c8e6c9; margin-bottom: 20px; display: flex; flex-direction: column; gap: 10px; }
        .delete-manager { background: #fff5f5; padding: 15px; border-radius: 10px; border: 1px solid #ffcdd2; margin-bottom: 20px; display: flex; flex-direction: column; gap: 10px; }
        .file-actions { display: flex; gap: 10px; justify-content: space-between; align-items: center; }
        .file-btn { background: #34495e; font-size: 14px; width: auto; }
        #file-input { display: none; }

        /* í€´ì¦ˆ ì˜ì—­ */
        .quiz-area { text-align: center; }
        .quiz-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #eee; }
        .q-display { font-size: 22px; font-weight: bold; margin: 10px 0 20px 0; text-align: left; line-height: 1.5; color: #333; background: #fafafa; padding: 20px; border-radius: 10px; border: 1px solid #eee; }
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .option-btn { background: white; border: 2px solid #ddd; padding: 15px 20px; border-radius: 10px; cursor: pointer; font-size: 18px; transition: 0.2s; text-align: left; color: #444; font-weight: 500; }
        .option-btn:hover { background: #f0f0f0; }
        .option-btn.selected { border-color: var(--selected); background-color: #f4ecf7; color: var(--selected); font-weight: bold; box-shadow: 0 0 0 2px var(--selected) inset; }
        .nav-box { display: flex; justify-content: space-between; margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee; }

        /* ê²°ê³¼ ë¦¬í¬íŠ¸ */
        .report-table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 14px; text-align: left; }
        .report-table th { background: #eee; padding: 10px; border-bottom: 2px solid #ddd; }
        .report-table td { padding: 10px; border-bottom: 1px solid #eee; }
        .row-wrong { background-color: #fff5f5; }
        .admin-list { margin-top: 10px; max-height: 400px; overflow-y: auto; border-top: 2px solid #eee; }
        .q-item { background: #f9f9f9; padding: 10px; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; align-items: center; }
        .q-title { font-weight: bold; font-size: 14px; }
        .q-info { font-size: 12px; color: #666; display: block; }

        /* ë„¤ì´ë²„ ë§í¬ ìŠ¤íƒ€ì¼ ì¹´ë“œ ë°°ë„ˆ */
.link-card-container {
    max-width: 600px;
    margin: 20px auto;
    padding: 10px;
}

.link-card {
    display: flex;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    overflow: hidden;
    text-decoration: none;
    color: #333;
    background: white;
    transition: box-shadow 0.2s;
}

.link-card:hover {
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
}

.card-image {
    width: 100px;
    min-width: 100px;
    background-color: #f4f6f8;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 40px;
    border-right: 1px solid #f0f0f0;
}

.card-info {
    padding: 15px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    overflow: hidden;
}

.card-title {
    font-weight: bold;
    font-size: 16px;
    margin-bottom: 5px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.card-desc {
    font-size: 13px;
    color: #666;
    margin-bottom: 8px;
    line-height: 1.4;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.card-url {
    font-size: 11px;
    color: #00c73c; /* ë„¤ì´ë²„ ë…¹ìƒ‰ ëŠë‚Œ */
}

    </style>
</head>
<body>

<div class="container">
    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('student')">ğŸ“ í•™ìƒìš© (ì‹œí—˜)</button>
        <button class="tab-btn" onclick="switchTab('teacher')">ğŸ‘¨â€ğŸ« ì„ ìƒë‹˜ìš© (ê´€ë¦¬)</button>
    </div>

    <div id="student-tab" class="tab-content active">
        <div id="setup-screen">
            <h2>ì‹œí—˜ ì¤€ë¹„</h2>
            <p style="color:#666; font-size:14px; margin-bottom:20px;">* ì›í•˜ëŠ” í•™ë…„ê³¼ ê³¼ëª©ì„ ì„ íƒí•˜ì„¸ìš”.</p>
            <div class="row">
                <select id="st-grade" onchange="updateDropdownState()">
                    <option value="">í•™ë…„ ì„ íƒ</option>
                    <option value="1">1í•™ë…„</option>
                    <option value="2">2í•™ë…„</option>
                    <option value="3">3í•™ë…„</option>
                    <option value="4">4í•™ë…„</option>
                    <option value="5">5í•™ë…„</option>
                    <option value="6">6í•™ë…„</option>
                </select>
                <select id="st-subject">
                    <option value="">ê³¼ëª© ì„ íƒ</option>
                    <option value="korean">êµ­ì–´</option>
                    <option value="math">ìˆ˜í•™</option>
                    <option value="english">ì˜ì–´</option>
                </select>
            </div>
            <button class="btn btn-primary" onclick="startQuiz()">ì‹œí—˜ ì‹œì‘í•˜ê¸°</button>
        </div>

        <div id="quiz-screen" style="display: none;">
            <div class="quiz-header">
                <button class="btn-home" onclick="goHome()">ğŸ  í™ˆìœ¼ë¡œ</button>
                <span id="quiz-progress" style="background:#eee; padding:5px 12px; border-radius:15px; font-size:14px; font-weight:bold;"></span>
            </div>
            
            <div id="quiz-info" style="text-align:center; color:#7f8c8d; font-size:14px; margin-bottom:10px;"></div>

            <div class="quiz-area">
                <div id="q-text" class="q-display"></div>
                <div id="options-area" class="options-grid"></div>
            </div>

            <div class="nav-box">
                <button id="btn-prev" class="btn btn-nav" onclick="moveQuestion(-1)">â¬… ì´ì „ ë¬¸ì œ</button>
                <button id="btn-next" class="btn btn-nav active" onclick="moveQuestion(1)">ë‹¤ìŒ ë¬¸ì œ â¡</button>
                <button id="btn-finish" class="btn btn-primary" style="display:none; width:48%;" onclick="finishQuiz()">ğŸ“ ë‹µì•ˆì§€ ì œì¶œ</button>
            </div>
        </div>

        <div id="score-panel" style="display: none; text-align: center;">
            <h2>ì‹œí—˜ ê²°ê³¼</h2>
            <div id="final-score" style="font-size: 40px; color: var(--secondary); font-weight: bold; margin: 20px 0;"></div>
            <p id="final-msg"></p>
            <h3 style="margin-top: 30px; border-left: 5px solid var(--correct);">ğŸ“ ìƒì„¸ ê²°ê³¼ ë¦¬í¬íŠ¸</h3>
            <div style="max-height: 300px; overflow-y: auto;">
                <table class="report-table">
                    <thead><tr><th width="45%">ë¬¸ì œ</th><th>ë‚´ ë‹µì•ˆ</th><th>ì •ë‹µ</th><th>ê²°ê³¼</th></tr></thead>
                    <tbody id="report-body"></tbody>
                </table>
            </div>
            <button class="btn btn-primary" onclick="goHome(true)" style="margin-top: 20px;">ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
        </div>
    </div>

    <div id="teacher-tab" class="tab-content">
        <h3>ğŸ“‚ íŒŒì¼ ì¶”ê°€</h3>
        <div class="file-manager">
            <p style="margin:0; font-size:14px; color:#555;">ë¬¸ì œì€í–‰ íŒŒì¼(CSV/JSON)ì„ ë¶ˆëŸ¬ì™€ì„œ ë¬¸ì œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.</p>
            <div class="file-actions" style="margin-top:10px;">
                <button class="btn file-btn" onclick="document.getElementById('file-input').click()">ğŸ“‚ íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°</button>
                <input type="file" id="file-input" accept=".json, .csv" onchange="handleFileUpload(this)">
            </div>
        </div>

        <h3>ğŸ—‘ï¸ ë°ì´í„° ì‚­ì œ</h3>
        <div class="delete-manager">
            <p style="margin:0 0 10px 0; font-size:14px; color:#c0392b;">ì‚­ì œí•  í•™ë…„ê³¼ ê³¼ëª©ì„ ì„ íƒí•˜ì„¸ìš”.</p>
            <div class="row">
                <select id="del-grade">
                    <option value="all">ì „ì²´ í•™ë…„</option>
                    <option value="1">1í•™ë…„</option>
                    <option value="2">2í•™ë…„</option>
                    <option value="3">3í•™ë…„</option>
                    <option value="4">4í•™ë…„</option>
                    <option value="5">5í•™ë…„</option>
                    <option value="6">6í•™ë…„</option>
                </select>
                <select id="del-subject">
                    <option value="all">ì „ì²´ ê³¼ëª©</option>
                    <option value="korean">êµ­ì–´</option>
                    <option value="math">ìˆ˜í•™</option>
                    <option value="english">ì˜ì–´</option>
                </select>
            </div>
            <button class="btn btn-delete-section" onclick="deleteSelectedData()">ì„ íƒí•œ ë°ì´í„° ì‚­ì œí•˜ê¸°</button>
        </div>

        <h3>ğŸ“ ë¬¸ì œ ê°œë³„ ê´€ë¦¬</h3>
        <div class="row">
            <select id="t-grade"><option value="1">1í•™ë…„</option><option value="2">2í•™ë…„</option><option value="3">3í•™ë…„</option><option value="4">4í•™ë…„</option><option value="5">5í•™ë…„</option><option value="6">6í•™ë…„</option></select>
            <select id="t-subject"><option value="korean">êµ­ì–´</option><option value="math">ìˆ˜í•™</option><option value="english">ì˜ì–´</option></select>
        </div>
        <input type="text" id="t-question" placeholder="ë¬¸ì œ ë‚´ìš©" />
        <input type="text" id="t-answer" placeholder="ì •ë‹µ" style="background: #e8f8f5; border-color: #27ae60;" />
        <div class="row">
            <input type="text" id="t-wrong1" placeholder="ì˜¤ë‹µ 1" />
            <input type="text" id="t-wrong2" placeholder="ì˜¤ë‹µ 2" />
            <input type="text" id="t-wrong3" placeholder="ì˜¤ë‹µ 3" />
        </div>
        <div class="row">
            <button id="btn-submit" class="btn btn-success" onclick="handleQuestionSubmit()">ë¬¸ì œ ë“±ë¡í•˜ê¸°</button>
            <button id="btn-cancel" class="btn btn-cancel" onclick="resetForm()">ìˆ˜ì • ì·¨ì†Œ</button>
        </div>

        <h3>ğŸ“‹ ì „ì²´ ë¬¸ì œ ëª©ë¡</h3>
        <div class="row">
            <select id="filter-grade" onchange="renderAdminList()"><option value="all">ì „ì²´ í•™ë…„</option><option value="1">1í•™ë…„</option><option value="2">2í•™ë…„</option><option value="3">3í•™ë…„</option><option value="4">4í•™ë…„</option><option value="5">5í•™ë…„</option><option value="6">6í•™ë…„</option></select>
            <select id="filter-subject" onchange="renderAdminList()"><option value="all">ì „ì²´ ê³¼ëª©</option><option value="korean">êµ­ì–´</option><option value="math">ìˆ˜í•™</option><option value="english">ì˜ì–´</option></select>
        </div>
        <div id="admin-list" class="admin-list"></div>
    </div>
</div>
<div class="link-card-container">
    <a href="https://blog.naver.com/utilman84/22417028813" class="link-card">
        <div class="card-image">
            <span>ğŸ“</span>
        </div>
        <div class="card-info">
            <div class="card-title">ì´ˆë“± 5í•™ë…„ êµ­ì–´ ë§ì¶¤ë²•/ì–´íœ˜ í€´ì¦ˆ</div>
            <div class="card-desc">ë§íˆë‹¤ vs ë§ì¶”ë‹¤, ì¢‡ë‹¤ vs ì«“ë‹¤... í—·ê°ˆë¦¬ëŠ” ë§ì¶¤ë²• ì™„ë²½ ì •ë¦¬!</div>
            <div class="card-url">github.io/quiz</div>
        </div>
    </a>
</div>

<script>
    let db = [];
    let editingId = null;

    window.onload = function() {
        const savedData = localStorage.getItem('quizDB');
        if (savedData) { db = JSON.parse(savedData); }
        renderAdminList();
        updateDropdownState();
    };

    function saveDB() {
        localStorage.setItem('quizDB', JSON.stringify(db));
        renderAdminList();
        updateDropdownState();
    }

    // === [ê¸°ëŠ¥] í™ˆìœ¼ë¡œ ì´ë™ ===
    function goHome(force = false) {
        if (!force) {
            if(!confirm("ì‹œí—˜ì„ ì¤‘ë‹¨í•˜ê³  í™ˆìœ¼ë¡œ ëŒì•„ê°€ì‹œê² ìŠµë‹ˆê¹Œ?\n(ì§„í–‰ ìƒí™©ì€ ì €ì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.)")) return;
        }
        document.getElementById('quiz-screen').style.display = "none";
        document.getElementById('score-panel').style.display = "none";
        document.getElementById('setup-screen').style.display = "block";
        
        // ë°ì´í„° ë¦¬í”„ë ˆì‹œ
        updateDropdownState();
    }

    // === [ê¸°ëŠ¥] ë¶€ë¶„ ì‚­ì œ ===
    function deleteSelectedData() {
        const grade = document.getElementById('del-grade').value;
        const subject = document.getElementById('del-subject').value;

        let msg = "";
        if(grade === 'all' && subject === 'all') msg = "ëª¨ë“  í•™ë…„, ëª¨ë“  ê³¼ëª©ì˜ ë°ì´í„°ë¥¼";
        else if(grade === 'all') msg = `[ëª¨ë“  í•™ë…„]ì˜ [${getSubjectName(subject)}] ë°ì´í„°ë¥¼`;
        else if(subject === 'all') msg = `[${grade}í•™ë…„]ì˜ [ëª¨ë“  ê³¼ëª©] ë°ì´í„°ë¥¼`;
        else msg = `[${grade}í•™ë…„]ì˜ [${getSubjectName(subject)}] ë°ì´í„°ë¥¼`;

        if(!confirm(`ì •ë§ë¡œ ${msg} ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;

        const initialCount = db.length;
        
        db = db.filter(item => {
            const gradeMatch = (grade === 'all' || item.grade === grade);
            const subjectMatch = (subject === 'all' || item.subject === subject);
            return !(gradeMatch && subjectMatch);
        });

        const deletedCount = initialCount - db.length;
        saveDB();
        alert(`${deletedCount}ê°œì˜ ë¬¸ì œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
    }

    // === ìŠ¤ë§ˆíŠ¸ í•„í„°ë§ ===
    function updateDropdownState() {
        const gradeSelect = document.getElementById('st-grade');
        const subjectSelect = document.getElementById('st-subject');
        const selectedGrade = gradeSelect.value;

        for (let i = 1; i < gradeSelect.options.length; i++) {
            const opt = gradeSelect.options[i];
            const hasData = db.some(item => item.grade === opt.value);
            opt.disabled = !hasData;
            opt.innerText = hasData ? `${opt.value}í•™ë…„` : `${opt.value}í•™ë…„ (X)`;
        }

        for (let i = 1; i < subjectSelect.options.length; i++) {
            const opt = subjectSelect.options[i];
            const sVal = opt.value;
            let baseText = getSubjectName(sVal);

            if (selectedGrade === "") {
                opt.disabled = true;
                opt.innerText = baseText;
                continue;
            }
            const count = db.filter(item => item.grade === selectedGrade && item.subject === sVal).length;
            opt.disabled = (count === 0);
            opt.innerText = count > 0 ? `${baseText} (${count}ë¬¸ì œ)` : `${baseText} (X)`;
        }
    }

    function handleFileUpload(input) {
        const file = input.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            const content = e.target.result;
            if (file.name.endsWith('.csv')) parseCSV(content);
            else if (file.name.endsWith('.json')) parseJSON(content);
            input.value = '';
        };
        reader.readAsText(file, 'UTF-8');
    }
    
    function parseJSON(text) {
        try { let data = JSON.parse(text); if(Array.isArray(data)) applyData(data); } 
        catch(e) { alert("JSON í˜•ì‹ ì˜¤ë¥˜"); }
    }

    function parseCSV(text) {
        const lines = text.split('\n');
        const newData = [];
        for (let i = 1; i < lines.length; i++) {
            const cols = lines[i].trim().split(',');
            if (cols.length >= 8) {
                newData.push({
                    id: cols[0].trim(), grade: cols[1].trim(), subject: cols[2].trim(),
                    q: cols[3].trim(), a: cols[4].trim(), w: [cols[5].trim(), cols[6].trim(), cols[7].trim()]
                });
            }
        }
        if(newData.length > 0) applyData(newData);
    }

    function applyData(newData) {
        if(confirm(`ë¬¸ì œ ${newData.length}ê°œë¥¼ ì¶”ê°€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
            const existingIds = new Set(db.map(item => String(item.id)));
            newData.forEach((item, idx) => {
                if(existingIds.has(String(item.id))) item.id = Date.now() + idx;
            });
            db = db.concat(newData);
            saveDB();
            alert(`ì¶”ê°€ ì™„ë£Œ! ì´ ${db.length}ë¬¸ì œ`);
        }
    }

    // === í€´ì¦ˆ ë¡œì§ ===
    let quizList = [], currentIdx = 0, userAnswers = [];

    function switchTab(tabName) {
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
        document.getElementById(tabName + '-tab').classList.add('active');
        if(tabName === 'student') {
            document.querySelector('.tabs button:nth-child(1)').classList.add('active');
            updateDropdownState();
        } else {
            document.querySelector('.tabs button:nth-child(2)').classList.add('active');
        }
    }

    function startQuiz() {
        const grade = document.getElementById('st-grade').value;
        const subject = document.getElementById('st-subject').value;
        if(!grade || !subject) { alert("í•™ë…„ê³¼ ê³¼ëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”."); return; }

        let candidates = db.filter(item => item.grade === grade && item.subject === subject);
        candidates.sort(() => Math.random() - 0.5);

        if (candidates.length === 0) { alert("ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤."); return; }

        quizList = [];
        let usedConcepts = new Set();
        for (let item of candidates) {
            if (quizList.length >= 20) break;
            let concept = item.a.includes("->") ? item.a.split("->")[1].trim() : item.a;
            if (!usedConcepts.has(concept)) {
                quizList.push(item);
                usedConcepts.add(concept);
            }
        }

        if(quizList.length === 0) { alert("ë¬¸ì œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤."); return; }

        currentIdx = 0;
        userAnswers = new Array(quizList.length).fill(null);
        document.getElementById('setup-screen').style.display = "none";
        document.getElementById('quiz-screen').style.display = "block";
        document.getElementById('quiz-info').innerText = `${grade}í•™ë…„ ${getSubjectName(subject)} í‰ê°€`;
        loadQuestion();
    }

    function loadQuestion() {
        const data = quizList[currentIdx];
        document.getElementById('quiz-progress').innerText = `ë¬¸ì œ ${currentIdx + 1} / ${quizList.length}`;
        document.getElementById('q-text').innerText = `Q${currentIdx+1}. ${data.q}`;

        const optionsArea = document.getElementById('options-area');
        optionsArea.innerHTML = "";

        if (!data.options) {
            let opts = [data.a, ...data.w];
            opts.sort(() => Math.random() - 0.5);
            data.options = opts; 
        }

        data.options.forEach((opt, index) => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            if (userAnswers[currentIdx] === opt) btn.classList.add('selected');
            btn.innerText = `${index + 1}. ${opt}`;
            btn.onclick = () => selectAnswer(opt);
            optionsArea.appendChild(btn);
        });

        document.getElementById('btn-prev').disabled = (currentIdx === 0);
        if (currentIdx === quizList.length - 1) {
            document.getElementById('btn-next').style.display = 'none';
            document.getElementById('btn-finish').style.display = 'block';
        } else {
            document.getElementById('btn-next').style.display = 'block';
            document.getElementById('btn-finish').style.display = 'none';
        }
    }

    function selectAnswer(selectedText) {
        userAnswers[currentIdx] = selectedText;
        loadQuestion();
    }

    function moveQuestion(step) {
        currentIdx += step;
        loadQuestion();
    }

    function finishQuiz() {
        const emptyCount = userAnswers.filter(a => a === null).length;
        if (emptyCount > 0 && !confirm(`ì•„ì§ ${emptyCount}ë¬¸ì œë¥¼ í’€ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì œì¶œí• ê¹Œìš”?`)) return;

        let score = 0;
        document.getElementById('quiz-screen').style.display = "none";
        document.getElementById('score-panel').style.display = "block";

        const tbody = document.getElementById('report-body');
        tbody.innerHTML = "";

        quizList.forEach((qData, idx) => {
            const myAns = userAnswers[idx];
            const isCorrect = (myAns === qData.a);
            if (isCorrect) score += 100 / quizList.length;

            const tr = document.createElement('tr');
            if (!isCorrect) tr.className = "row-wrong";
            tr.innerHTML = `<td>Q${idx+1}. ${qData.q}</td><td style="${!isCorrect ? 'color:#e74c3c;font-weight:bold;' : ''}">${myAns || "-"}</td><td style="color:#27ae60;font-weight:bold;">${qData.a}</td><td>${isCorrect ? "O" : "X"}</td>`;
            tbody.appendChild(tr);
        });

        const finalScore = Math.round(score);
        document.getElementById('final-score').innerText = finalScore + "ì ";
        document.getElementById('final-msg').innerText = finalScore >= 80 ? "ì°¸ ì˜í–ˆì–´ìš”! ğŸ‘" : "ìˆ˜ê³ í–ˆì–´ìš”! ğŸ’ª";
    }

    // === ê´€ë¦¬ ê¸°ëŠ¥ ===
    function handleQuestionSubmit() {
        const grade = document.getElementById('t-grade').value;
        const subject = document.getElementById('t-subject').value;
        const q = document.getElementById('t-question').value.trim();
        const a = document.getElementById('t-answer').value.trim();
        const w1 = document.getElementById('t-wrong1').value.trim();
        const w2 = document.getElementById('t-wrong2').value.trim();
        const w3 = document.getElementById('t-wrong3').value.trim();

        if (!q || !a || !w1) { alert("ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”."); return; }

        if (editingId) {
            const index = db.findIndex(item => String(item.id) === String(editingId));
            if (index !== -1) db[index] = { id: editingId, grade, subject, q, a, w: [w1, w2, w3] };
        } else {
            db.push({ id: Date.now(), grade, subject, q, a, w: [w1, w2, w3] });
        }
        saveDB();
        resetForm();
    }

    function editQuestion(id) {
        const item = db.find(q => String(q.id) === String(id));
        if (!item) return;
        document.getElementById('t-grade').value = item.grade;
        document.getElementById('t-subject').value = item.subject;
        document.getElementById('t-question').value = item.q;
        document.getElementById('t-answer').value = item.a;
        document.getElementById('t-wrong1').value = item.w[0];
        document.getElementById('t-wrong2').value = item.w[1];
        document.getElementById('t-wrong3').value = item.w[2];
        editingId = id;
        document.getElementById('btn-submit').innerText = "ìˆ˜ì • ì™„ë£Œ";
        document.getElementById('btn-submit').classList.replace('btn-success', 'btn-primary');
        document.getElementById('btn-cancel').style.display = "block";
    }

    function deleteQuestion(id) {
        if(confirm("ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            db = db.filter(item => String(item.id) !== String(id));
            saveDB();
        }
    }

    function resetForm() {
        editingId = null;
        document.getElementById('t-question').value = "";
        document.getElementById('t-answer').value = "";
        document.getElementById('t-wrong1').value = "";
        document.getElementById('t-wrong2').value = "";
        document.getElementById('t-wrong3').value = "";
        document.getElementById('btn-submit').innerText = "ë¬¸ì œ ë“±ë¡í•˜ê¸°";
        document.getElementById('btn-submit').classList.replace('btn-primary', 'btn-success');
        document.getElementById('btn-cancel').style.display = "none";
    }

    function renderAdminList() {
        const listArea = document.getElementById('admin-list');
        const fGrade = document.getElementById('filter-grade').value;
        const fSubject = document.getElementById('filter-subject').value;
        listArea.innerHTML = "";

        const filtered = db.filter(item => 
            (fGrade === 'all' || item.grade === fGrade) && 
            (fSubject === 'all' || item.subject === fSubject)
        );

        if (filtered.length === 0) listArea.innerHTML = "<p style='text-align:center;color:#999;padding:20px;'>ë¬¸ì œ ì—†ìŒ</p>";
        else filtered.forEach(item => {
            const div = document.createElement('div');
            div.className = 'q-item';
            div.innerHTML = `<div style="flex:1;"><span class="q-title">${item.q}</span><span class="q-info">[${item.grade}í•™ë…„ ${getSubjectName(item.subject)}] ë‹µ: ${item.a}</span></div><div><button class="btn btn-edit" onclick="editQuestion('${item.id}')">ìˆ˜ì •</button><button class="btn btn-danger" onclick="deleteQuestion('${item.id}')">ì‚­ì œ</button></div>`;
            listArea.appendChild(div);
        });
    }

    function getSubjectName(code) {
        if(code === 'korean') return 'êµ­ì–´';
        if(code === 'math') return 'ìˆ˜í•™';
        if(code === 'english') return 'ì˜ì–´';
        return code;
    }
</script>
</body>
</html>